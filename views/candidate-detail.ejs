<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <title>Candidate Details</title>
  <style>
    ul,
    li,
    ol {
      list-style: none;
    }

    .key,
    .value {
      font-weight: 500;
      font-size: 17px;
    }

    .value {
      margin-left: 6px;
    }

    li {
      margin-top: 8px;
    }

    #printableArea.pdf-mode {
      font-size: 12px;
    }

    .downloadButton {
      background-color: #39a2f8;
      border: none;
      outline: none;
      padding: 8px 30px;
      color: white;
      border-radius: 8px;
      border: 1px solid #39a2f8;
      text-decoration: none;
    }

    #printableArea {
      font-size: 14px;
      line-height: 1.5;
    }

    #printableArea h1 {
      font-size: 18px;
    }

    #printableArea p {
      font-size: 14px;
    }

    #printableArea td,
    #printableArea th {
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div style="
        background-image: url('https://img.freepik.com/free-vector/ombre-blue-curve-light-blue-background_53876-173299.jpg?semt=ais_hybrid&w=740');
        background-size: cover;
        height: 100px;
      ">
    <h3 class="p-4">Onboarding Form</h3>
  </div>

  <section class="py-5">
    <div id="printableArea">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center">
          <h4>Personal Details</h4>
          <a href="javascript:void(0);" onclick="downloadPDF()" class="downloadButton">Download</a>
        </div>

        <table class="table table-bordered mt-3">
          <tbody>
            <tr>
              <th>Full Name</th>
              <td>
                <%= data?.form?.fullName %>
              </td>
              <th>Father's Name</th>
              <td>
                <%= data?.form?.fatherName %>
              </td>
            </tr>
            <tr>
              <th>Mother's Name</th>
              <td>
                <%= data?.form?.motherName %>
              </td>
              <th>Email Address</th>
              <td>
                <%= data?.form?.email %>
              </td>
            </tr>
            <tr>
              <th>Mobile Number</th>
              <td>
                <%= data?.form?.number %>
              </td>
              <th>Alternate Mobile Number</th>
              <td>
                <%= data?.form?.AlternateNumber %>
              </td>
            </tr>
            <tr>
              <th>Father's Mobile Number</th>
              <td>
                <%= data?.form?.fatherNumber %>
              </td>
              <th>Mother's Mobile Number</th>
              <td>
                <%= data?.form?.motherNumber %>
              </td>
            </tr>
            <tr>
              <th>Current Address</th>
              <td colspan="3">
                <%= data?.form?.currentAddress %>
              </td>
            </tr>
            <tr>
              <th>City</th>
              <td>
                <%= data?.form?.currentCity %>
              </td>
              <th>Pincode</th>
              <td>
                <%= data?.form?.currentPincode %>
              </td>
            </tr>
          </tbody>
        </table>

        <h4 class="mt-4">Permanent Address</h4>
        <table class="table table-bordered mt-3">
          <tbody>
            <tr>
              <th>Permanent Address</th>
              <td colspan="3">
                <%= data?.form?.permanentAddress %>
              </td>
            </tr>
            <tr>
              <th>City</th>
              <td>
                <%= data?.form?.permanentCity %>
              </td>
              <th>Pincode</th>
              <td>
                <%= data?.form?.permanentPincode %>
              </td>
            </tr>
          </tbody>
        </table>

        <h4 class="mt-4">Documents</h4>
        <table class="table table-bordered mt-3">
          <tbody>
            <tr>
              <th>Pan Card Front <span style="margin-left: 30px;" class=" inline-block">
                  <%= data?.form?.panFront.slice(7) %>
                </span></th>
              <td><a href="/<%= data?.form?.panFront %>" download>Download</a></td>
              <th>Pan Card Back <span style="margin-left: 30px;" class=" inline-block">
                  <%= data?.form?.panFront.slice(7) %>
                </span></th>
              <td><a href="/<%= data?.form?.panBack %>" download>Download</a></td>
            </tr>
            <tr>
              <th>Aadhar Card Front <span style="margin-left: 30px;" class=" inline-block">
                  <%= data?.form?.panFront.slice(7) %>
                </span></th>
              <td><a href="/<%= data?.form?.aadharFront %>" download>Download</a></td>
              <th>Aadhar Card Back <span style="margin-left: 30px;" class=" inline-block">
                  <%= data?.form?.panFront.slice(7) %>
                </span></th>
              <td><a href="/<%= data?.form?.aadharBack %>" download>Download</a></td>
            </tr>
            <tr>
              <th>10th Marksheet <span style="margin-left: 30px;" class=" inline-block">
                  <%= data?.form?.panFront.slice(7) %>
                </span></th>
              <td><a href="/<%= data?.form?.marksheet10 %>" download>Download</a></td>
              <th>12th Marksheet <span style="margin-left: 30px;" class=" inline-block">
                  <%= data?.form?.panFront.slice(7) %>
                </span></th>
              <td><a href="/<%= data?.form?.marksheet12 %>" download>Download</a></td>
            </tr>
            <tr>
              <th>Last Qualification Marksheet <span style="margin-left: 30px;" class=" inline-block">
                  <%= data?.form?.panFront.slice(7) %>
                </span></th>
              <td><a href="/<%= data?.form?.lastQualificationMarksheet %>" download>Download</a></td>
              <th>Last Qualification</th>
              <td>
                <%= data?.form?.lastQualification %>
              </td>
            </tr>
          </tbody>
        </table>

        <% if (data?.form?.experienceType==='fresher' ) { %>
          <h4 class="mt-4">Experience</h4>
          <table class="table table-bordered mt-3">
            <tbody>
              <tr>
                <th>Experience</th>
                <td colspan="3">Fresher</td>
              </tr>
              <% if (data?.form?.fresherCV) { %>
                <tr>
                  <th>Fresher CV</th>
                  <td colspan="3"><a href="/<%= data?.form?.fresherCV %>" download>Download</a></td>
                </tr>
                <% } %>
            </tbody>
          </table>
          <% } else if (data?.form?.experiences?.length> 0) { %>
            <h4 class="mt-4">Work Experience</h4>
            <% data.form.experiences.forEach((exp, index)=> { %>
              <table class="table table-bordered mt-3">
                <tbody>
                  <tr>
                    <th>Company Name</th>
                    <td>
                      <%= exp.companyName %>
                    </td>
                    <th>Job Title</th>
                    <td>
                      <%= exp.jobRole %>
                    </td>
                  </tr>
                  <tr>
                    <th>Work Duration</th>
                    <td>
                      <%= exp.startDate %> - <%= exp.endDate %>
                    </td>
                    <th>Company Location</th>
                    <td>
                      <%= exp.location %>
                    </td>
                  </tr>
                  <tr>
                    <th>Resume</th>
                    <td colspan="3"><a href="/<%=data?.form?.resume %>" download>Download</a></td>
                  </tr>
                </tbody>
              </table>
              <% }) %>
                <% } %>
      </div>
    </div>
  </section>

  <script>
    function downloadPDF() {
      const element = document.getElementById('printableArea');
      element.classList.add("pdf-mode");

      // Backup original HTML to restore after PDF generation
      const originalHTML = element.innerHTML;

      // Replace <a download> links with file names
      const anchors = element.querySelectorAll('a[download]');
      anchors.forEach(anchor => {
        const href = anchor.getAttribute('href');
        const urlParts = href.split('/');
        const fileName = urlParts[urlParts.length - 1];
        const span = document.createElement('span');
        span.innerText = fileName || 'File not available';
        anchor.parentNode.replaceChild(span, anchor);
      });

      const opt = {
        margin: [0.5, 0.5, 0.5, 0.5],
        filename: 'Candidate-Details.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: {
          scale: 2,
          useCORS: true,
          scrollY: 0
        },
        jsPDF: {
          unit: 'in',
          format: 'a4',
          orientation: 'portrait'
        },
        pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
      };

      html2pdf().set(opt).from(element).save().then(() => {
        element.innerHTML = originalHTML; // restore
        element.classList.remove("pdf-mode");
      });
    }
  </script>

</body>

</html>