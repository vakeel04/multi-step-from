<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
    <title>Add Job</title>
  </head>

  <style>
    input {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: solid 1px #ccc;
      outline: none;
      border-radius: 8px;
      height: 47.5px;
    }
    .inputMain {
      flex: 1;
    }
    .generateButton,
    .addButton {
      background-color: #39a2f8;
      border: none;
      outline: none;
      padding: 8px 30px;
      color: white;
      border-radius: 8px;
      border: 1px solid #39a2f8;
    }
    .addButton {
      color: #39a2f8;
      background-color: transparent;
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #ccc;
      padding: 15px 30px;
      border-collapse: separate; /* This line is important */
      overflow: hidden; /* Optional: clip inner border corners */
    }

    #logo {
      cursor: pointer;
    }
  </style>
  <body>
    <div
      style="
        background-image: url(&quot;https://img.freepik.com/free-vector/ombre-blue-curve-light-blue-background_53876-173299.jpg?semt=ais_hybrid&w=740&quot;);
        background-size: cover;
        height: 100px;
      "
    >
      <h3 class="p-4">Onboarding Form</h3>
    </div>

    <section class="py-5">
      <div class="container">
        <div>
          <h4>Company Profile</h4>

          <form class="gap-3" id="jobForm" action="/job" method="POST"enctype="multipart/form-data">
            <div class="d-flex gap-4">
              <div class="inputMain">
                <label>Name</label> <br />
                <input type="text" name="companyName" class="border mt-1" />
              </div>
  
              <div class="inputMain">
                <label>Logo</label> <br />
                <input id="logo" type="file" name="logo" class="border mt-1" />
              </div>
            </div>
        <div class="mt-4">
          <h4>Job Details</h4>

            <div id="inputContainer">
              <div class="inputMain">
                <label>Job Title</label> <br />
                <input type="text"  name="jobRole[]" class="border mt-1" />
              </div>
            </div>

            <div>
              <button type="button" class="addButton" onclick="addJobInput()">
                + Add
              </button>
            </div>
        </div>

        <div class="mt-4">
            <div class="d-flex gap-3">
              <div class="inputMain">
                <label>Candidate Name</label> <br />
                <input type="text" name="candidateName" class="border mt-1" />
              </div>

              <div class="inputMain">
                <label>Link</label> <br />
                <input type="text" class="border mt-1" disabled />
              </div>
            </div>

            <div class="mt-4">
              <button class="generateButton">Generate Link</button>
            </div>
          </div>
        </form>

        <table class="mt-5" cellpadding="8" cellspacing="0">
          <thead>
            <tr>
              <th>S.No</th>
              <th>Candidate Name</th>
              <th>Date</th>
              <th>Job Title</th>
              <th>Generated Link</th>
              <th>Candidate Details</th>
            </tr>
          </thead>
          <tbody>
            <% data?.job?.forEach((form, index) => { %>
              <tr>
                <td><%= index + 1 %></td>
                <td><%= form.candidateName %></td>
                <td><%= form.createdAt.toLocaleDateString("en-GB") %></td>
                <td>
                  <% if (Array.isArray(form.jobRole) && form.jobRole.length > 0) { %>
                    <%= form.jobRole.join(", ") %>
                  <% } else { %>
                    N/A
                  <% } %>
                </td>
                <td>
                  <a href="/multistep-form/<%= form.link %>" target="_blank">Link</a>
                </td>
                <td>
                  <a href="/candidate-detail/<%= form.link %>">Show Details</a>
                </td>
              </tr>
            <% }); %>
          </tbody>  
        </table>
      </div>
    </section>

    <script>
      function addJobInput() {
        const container = document.getElementById("inputContainer");

        const newInputDiv = document.createElement("div");
        newInputDiv.className = "inputMain";
        newInputDiv.innerHTML = `
      <input type="text" class="border mt-3" />
    `;

        container.appendChild(newInputDiv);
      }
    </script>

<script>
  // Function to add dynamic Job Title input fields
  function addJobInput() {
    const container = document.getElementById("inputContainer");
    const newInputDiv = document.createElement("div");
    newInputDiv.className = "inputMain";
    newInputDiv.innerHTML = `
      <label>Job Title</label><br/>
      <input type="text" name="jobRole[]" class="border mt-1" />
    `;
    container.appendChild(newInputDiv);
  }

  // Handle form submission with JavaScript
  document.getElementById("jobForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const form = document.getElementById("jobForm");
    const formData = new FormData();

    // Get form inputs manually
    const companyName = form.querySelector('input[name="companyName"]').value;
    const candidateName = form.querySelector('input[name="candidateName"]').value;
    const logoFile = form.querySelector('input[name="logo"]').files[0];

    const jobRoles = form.querySelectorAll('input[name="jobRole[]"]');

    formData.append("companyName", companyName);
    formData.append("candidateName", candidateName);
    if (logoFile) {
      formData.append("logo", logoFile);
    }

    jobRoles.forEach((input) => {
      formData.append("jobRole", input.value); // Backend should accept array
    });

    try {
      const response = await fetch("/job", {
        method: "POST",
        body: formData,
      });

      const result = await response.json();

      if (result.status) {
        alert("Link generated successfully!");
        form.reset();
        window.location.reload();
      } else {
        alert(result.message || "Failed to generate link.");
      }
    } catch (err) {
      console.error(err);
      alert("Something went wrong.");
    }
  });
</script>

  </body>
</html>
